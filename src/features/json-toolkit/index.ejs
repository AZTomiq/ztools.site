<!-- title: <%= t('json.title') %> - ZTools -->
<link rel="stylesheet" href="<%= toolConfig._assets.css %>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>

<section class="tool-container">
  <div class="page-header">
    <h1>ðŸ’» <%= t('json.title') %>
    
      <% if (typeof toolConfig !== 'undefined' && toolConfig.meta && toolConfig.meta.version) { %>
        <button class="version-badge" id="open-changelog" aria-label="View Changelog">v<%= toolConfig.meta.version %></button>
      <% } %></h1>
    <p>
      <%= t('json.desc') %>
    </p>
  </div>

  <!-- Tools Navigation -->
  <div class="tools-nav">
    <button class="tab-btn active" onclick="switchTab('format')" data-tab="format">
      <%= t('json.tabs.format') %>
    </button>
    <button class="tab-btn" onclick="switchTab('convert')" data-tab="convert">
      <%= t('json.tabs.convert') %>
    </button>
    <button class="tab-btn" onclick="switchTab('tools')" data-tab="tools">
      <%= t('json.tabs.tools') %>
    </button>
  </div>

  <!-- TAB 1: FORMAT & VALIDATE (Merged with Tree View) -->
  <div id="tab-format" class="tab-panel active">
    <div class="toolbar">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="formatJSON()">
          <%= t('json.toolbar.format') %>
        </button>
        <button class="btn" onclick="minifyJSON()">
          <%= t('json.toolbar.minify') %>
        </button>
        <button class="btn" onclick="validateJSON()">
          <%= t('json.toolbar.validate') %>
        </button>
        <button class="btn" onclick="copyJSON()">
          <%= t('json.toolbar.copy') %>
        </button>
        <button class="btn btn-danger" onclick="clearJSON()">
          <%= t('json.toolbar.clear') %>
        </button>
      </div>

      <div class="divider"></div>

      <label>
        <span>
          <%= t('json.toolbar.indent') %>
        </span>
        <select id="indent-size" onchange="updateIndent()">
          <option value="2" selected>
            <%= t('json.toolbar.indent_opts.space2') %>
          </option>
          <option value="4">
            <%= t('json.toolbar.indent_opts.space4') %>
          </option>
          <option value="tab">
            <%= t('json.toolbar.indent_opts.tab') %>
          </option>
        </select>
      </label>
    </div>

    <div class="editor-layout" id="editor-layout">
      <!-- Input Panel -->
      <div class="editor-panel" id="input-panel">
        <div class="panel-header">
          <h3>
            <%= t('json.input.title') %>
          </h3>
          <div class="panel-actions">
            <button class="btn-sm" onclick="loadSample()">
              <%= t('json.input.load_sample') %>
            </button>
            <button class="btn-icon" onclick="togglePanel('input')" title="Maximize/Restore">â›¶</button>
          </div>
        </div>
        <div id="monaco-input" class="monaco-editor-container"></div>
      </div>

      <!-- Output Panel -->
      <div class="editor-panel" id="output-panel">
        <div class="panel-header">
          <div class="header-left">
            <h3>
              <%= t('json.output.title') %>
            </h3>
            <!-- View Toggle -->
            <div class="view-toggle">
              <button class="view-btn active" onclick="toggleOutputView('code')" id="btn-view-code">
                <%= t('json.output.view.code') %>
              </button>
              <button class="view-btn" onclick="toggleOutputView('tree')" id="btn-view-tree">
                <%= t('json.output.view.tree') %>
              </button>
            </div>
          </div>
          <div class="panel-actions">
            <!-- Tree Controls (Hidden by default) -->
            <div id="tree-controls" class="btn-group" style="display: none; margin-right: 1rem;">
              <button class="btn-icon" onclick="expandAll()" title="Expand All">âž•</button>
              <button class="btn-icon" onclick="collapseAll()" title="Collapse All">âž–</button>
            </div>

            <div class="output-stats" id="output-stats"></div>
            <button class="btn-icon" onclick="togglePanel('output')" title="Maximize/Restore">â›¶</button>
          </div>
        </div>

        <!-- Code View -->
        <div id="monaco-output" class="view-content active monaco-editor-container"></div>

        <!-- Tree View -->
        <div id="tree-container" class="view-content tree-view-container" style="display: none;">
          <div class="tree-placeholder">
            <%= t('json.output.tree_placeholder') %>
          </div>
        </div>

        <!-- Path Display for Tree -->
        <div id="path-display" class="path-display" onclick="copyPath()">
          <%= t('json.output.path_hint') %>
        </div>
      </div>
    </div>

    <div id="validation-result" class="validation-result"></div>
  </div>

  <!-- Tab 2: Convert -->
  <div id="tab-convert" class="tab-panel">
    <div class="convert-layout">
      <!-- Controls -->
      <div class="toolbar">
        <label>
          <%= t('json.convert.label') %>
            <select id="convert-format" onchange="updateConvertLanguage()">
              <option value="xml">
                <%= t('json.convert.formats.xml') %>
              </option>
              <option value="yaml">
                <%= t('json.convert.formats.yaml') %>
              </option>
              <option value="csv">
                <%= t('json.convert.formats.csv') %>
              </option>
              <option value="typescript">
                <%= t('json.convert.formats.ts') %>
              </option>
              <option value="go">
                <%= t('json.convert.formats.go') %>
              </option>
              <option value="java">
                <%= t('json.convert.formats.java') %>
              </option>
              <option value="protobuf">
                <%= t('json.convert.formats.proto') %>
              </option>
            </select>
        </label>
        <button class="btn btn-primary" onclick="convertJSON()">
          <span class="icon">ðŸ”„</span>
          <%= t('json.convert.btn_convert') %>
        </button>
        <button class="btn" onclick="copyConverted()">
          <span class="icon">ðŸ“‹</span>
          <%= t('json.convert.btn_copy') %>
        </button>
      </div>

      <!-- Editors -->
      <div class="split-editor" style="height: 600px;">
        <div class="single-editor">
          <div class="editor-label">
            <%= t('json.convert.input_label') %>
          </div>
          <div id="monaco-convert-input" class="monaco-editor-container"></div>
        </div>
        <div class="single-editor">
          <div class="editor-label">
            <%= t('json.convert.output_label') %>
          </div>
          <div id="monaco-convert-output" class="monaco-editor-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab 4: Tools -->
  <div id="tab-tools" class="tab-panel">
    <div class="tools-wrapper">
      <!-- Sidebar -->
      <div class="tools-sidebar">
        <div class="tool-menu-item active" onclick="switchSubTool('csv')" data-subtool="csv">
          <%= t('json.tools_menu.csv') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('js-obj')" data-subtool="js-obj">
          <%= t('json.tools_menu.js_obj') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('sql')" data-subtool="sql">
          <%= t('json.tools_menu.sql') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('path')" data-subtool="path">
          <%= t('json.tools_menu.path') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('diff')" data-subtool="diff">
          <%= t('json.tools_menu.diff') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('stats')" data-subtool="stats">
          <%= t('json.tools_menu.stats') %>
        </div>
        <div class="tool-menu-item" onclick="switchSubTool('escape')" data-subtool="escape">
          <%= t('json.tools_menu.escape') %>
        </div>
      </div>

      <!-- Main Area -->
      <div class="tool-main-area">

        <!-- CSV Tool -->
        <div id="subtool-csv" class="tool-workspace active">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.csv.title') %>
            </h3>
            <p>
              <%= t('json.subtools.csv.desc') %>
            </p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.csv.input') %>
              </div>
              <textarea id="csv-input" placeholder="name,age\nAlice,30"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.csv.output') %>
              </div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="csvToJSONTool()">
                  <%= t('json.subtools.csv.btn') %>
                </button>
              </div>
              <textarea id="csv-result" readonly placeholder="Result..."></textarea>
            </div>
          </div>
        </div>

        <!-- JS Obj Tool -->
        <div id="subtool-js-obj" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.js_obj.title') %>
            </h3>
            <p>
              <%= t('json.subtools.js_obj.desc') %>
            </p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.js_obj.input') %>
              </div>
              <textarea id="js-obj-input" placeholder="{ name: 'Alice', age: 30 }"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.js_obj.output') %>
              </div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="jsObjToJSON()">
                  <%= t('json.subtools.js_obj.btn') %>
                </button>
              </div>
              <textarea id="js-obj-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- SQL Tool -->
        <div id="subtool-sql" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.sql.title') %>
            </h3>
            <p>
              <%= t('json.subtools.sql.desc') %>
            </p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.sql.input') %>
              </div>
              <textarea id="sql-input" placeholder="INSERT INTO users..."></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.sql.output') %>
              </div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="sqlToJSONTool()">
                  <%= t('json.subtools.sql.btn') %>
                </button>
              </div>
              <textarea id="sql-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- Path Tool -->
        <div id="subtool-path" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.path.title') %>
            </h3>
            <p>
              <%= t('json.subtools.path.desc') %>
            </p>
          </div>
          <div class="tool-controls">
            <input type="text" id="search-value" placeholder="<%= t('json.subtools.path.placeholder') %>">
            <button class="btn btn-primary" onclick="findPath()">
              <%= t('json.subtools.path.btn') %>
            </button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.path.input') %>
              </div>
              <textarea id="path-json" placeholder='{"user": "Alice"}'></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.path.output') %>
              </div>
              <textarea id="path-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- Diff Tool -->
        <div id="subtool-diff" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.diff.title') %>
            </h3>
            <p>
              <%= t('json.subtools.diff.desc') %>
            </p>
          </div>
          <div class="tool-controls" style="margin-bottom: 0.5rem;">
            <button class="btn btn-primary" onclick="compareJSON()">
              <%= t('json.subtools.diff.btn') %>
            </button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.diff.json1') %>
              </div>
              <textarea id="diff-json1" placeholder='{"a": 1}'></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.diff.json2') %>
              </div>
              <textarea id="diff-json2" placeholder='{"a": 2}'></textarea>
            </div>
          </div>
          <div style="margin-top: 1rem;">
            <div class="editor-label">
              <%= t('json.subtools.diff.result') %>
            </div>
            <div id="diff-result" class="result-box" style="display:none"></div>
          </div>
        </div>

        <!-- Stats Tool -->
        <div id="subtool-stats" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.stats.title') %>
            </h3>
            <p>
              <%= t('json.subtools.stats.desc') %>
            </p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.stats.input') %>
              </div>
              <textarea id="stats-json" placeholder='{"items": [1, 2, 3]}'></textarea>
            </div>
            <div class="single-editor">
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="analyzeJSON()">
                  <%= t('json.subtools.stats.btn') %>
                </button>
              </div>
              <div class="editor-label">
                <%= t('json.subtools.stats.result') %>
              </div>
              <div id="stats-result" class="result-box" style="display:none"></div>
            </div>
          </div>
        </div>

        <!-- Escape Tool -->
        <div id="subtool-escape" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>
              <%= t('json.subtools.escape.title') %>
            </h3>
          </div>
          <div class="tool-controls" style="margin-bottom: 0.5rem;">
            <button class="btn" onclick="escapeJSON()">
              <%= t('json.subtools.escape.btn_esc') %>
            </button>
            <button class="btn" onclick="unescapeJSON()">
              <%= t('json.subtools.escape.btn_unesc') %>
            </button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.escape.input') %>
              </div>
              <textarea id="escape-input"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">
                <%= t('json.subtools.escape.result') %>
              </div>
              <textarea id="escape-result" readonly></textarea>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script src="<%= toolConfig._assets.js %>"></script>