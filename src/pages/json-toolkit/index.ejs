<!-- title: <%= t('json.title') %> - ZTools -->
<link rel="stylesheet" href="<%= rootPath %>assets/css/json-toolkit.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>

<section class="tool-container">
  <div class="page-header">
    <h1>üíª <%= t('json.title') %>
    </h1>
    <p>
      <%= t('json.desc') %>
    </p>
  </div>

  <!-- Tools Navigation -->
  <div class="tools-nav">
    <button class="tab-btn active" onclick="switchTab('format')" data-tab="format">‚ú® Format & Validate</button>
    <button class="tab-btn" onclick="switchTab('convert')" data-tab="convert">üîÑ Convert</button>
    <button class="tab-btn" onclick="switchTab('tools')" data-tab="tools">üõ†Ô∏è Tools</button>
  </div>

  <!-- TAB 1: FORMAT & VALIDATE (Merged with Tree View) -->
  <div id="tab-format" class="tab-panel active">
    <div class="toolbar">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="formatJSON()">‚ú® Format / Beautify</button>
        <button class="btn" onclick="minifyJSON()">üì¶ Minify</button>
        <button class="btn" onclick="validateJSON()">‚úÖ Validate</button>
        <button class="btn" onclick="copyJSON()">üìã Copy</button>
        <button class="btn btn-danger" onclick="clearJSON()">üóëÔ∏è Clear</button>
      </div>

      <div class="divider"></div>

      <label>
        <span>Indent:</span>
        <select id="indent-size" onchange="updateIndent()">
          <option value="2" selected>2 spaces</option>
          <option value="4">4 spaces</option>
          <option value="tab">Tab</option>
        </select>
      </label>
    </div>

    <div class="editor-layout" id="editor-layout">
      <!-- Input Panel -->
      <div class="editor-panel" id="input-panel">
        <div class="panel-header">
          <h3>Input</h3>
          <div class="panel-actions">
            <button class="btn-sm" onclick="loadSample()">Load Sample</button>
            <button class="btn-icon" onclick="togglePanel('input')" title="Maximize/Restore">‚õ∂</button>
          </div>
        </div>
        <div id="monaco-input" class="monaco-editor-container"></div>
      </div>

      <!-- Output Panel -->
      <div class="editor-panel" id="output-panel">
        <div class="panel-header">
          <div class="header-left">
            <h3>Output</h3>
            <!-- View Toggle -->
            <div class="view-toggle">
              <button class="view-btn active" onclick="toggleOutputView('code')" id="btn-view-code">Code</button>
              <button class="view-btn" onclick="toggleOutputView('tree')" id="btn-view-tree">Tree</button>
            </div>
          </div>
          <div class="panel-actions">
            <!-- Tree Controls (Hidden by default) -->
            <div id="tree-controls" class="btn-group" style="display: none; margin-right: 1rem;">
              <button class="btn-icon" onclick="expandAll()" title="Expand All">‚ûï</button>
              <button class="btn-icon" onclick="collapseAll()" title="Collapse All">‚ûñ</button>
            </div>

            <div class="output-stats" id="output-stats"></div>
            <button class="btn-icon" onclick="togglePanel('output')" title="Maximize/Restore">‚õ∂</button>
          </div>
        </div>

        <!-- Code View -->
        <div id="monaco-output" class="view-content active monaco-editor-container"></div>

        <!-- Tree View -->
        <div id="tree-container" class="view-content tree-view-container" style="display: none;">
          <div class="tree-placeholder">Format JSON to see tree view</div>
        </div>

        <!-- Path Display for Tree -->
        <div id="path-display" class="path-display" onclick="copyPath()">Click on a key to see path</div>
      </div>
    </div>

    <div id="validation-result" class="validation-result"></div>
  </div>

  <!-- Tab 2: Convert -->
  <div id="tab-convert" class="tab-panel">
    <div class="convert-layout">
      <!-- Controls -->
      <div class="toolbar">
        <label>
          Convert to:
          <select id="convert-format" onchange="updateConvertLanguage()">
            <option value="xml">XML</option>
            <option value="yaml">YAML</option>
            <option value="csv">CSV</option>
            <option value="typescript">TypeScript Interface</option>
            <option value="go">Go Struct</option>
            <option value="java">Java Class</option>
            <option value="protobuf">Protobuf (gRPC)</option>
          </select>
        </label>
        <button class="btn btn-primary" onclick="convertJSON()">
          <span class="icon">üîÑ</span> Convert
        </button>
        <button class="btn" onclick="copyConverted()">
          <span class="icon">üìã</span> Copy Result
        </button>
      </div>

      <!-- Editors -->
      <div class="split-editor" style="height: 600px;">
        <div class="single-editor">
          <div class="editor-label">JSON Input</div>
          <div id="monaco-convert-input" class="monaco-editor-container"></div>
        </div>
        <div class="single-editor">
          <div class="editor-label">Converted Output</div>
          <div id="monaco-convert-output" class="monaco-editor-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab 4: Tools -->
  <div id="tab-tools" class="tab-panel">
    <div class="tools-wrapper">
      <!-- Sidebar -->
      <div class="tools-sidebar">
        <div class="tool-menu-item active" onclick="switchSubTool('csv')" data-subtool="csv">üìä CSV to JSON</div>
        <div class="tool-menu-item" onclick="switchSubTool('js-obj')" data-subtool="js-obj">üíª JS Obj to JSON</div>
        <div class="tool-menu-item" onclick="switchSubTool('sql')" data-subtool="sql">üóÑÔ∏è SQL to JSON</div>
        <div class="tool-menu-item" onclick="switchSubTool('path')" data-subtool="path">ÔøΩ Path Finder</div>
        <div class="tool-menu-item" onclick="switchSubTool('diff')" data-subtool="diff">‚öñÔ∏è JSON Diff</div>
        <div class="tool-menu-item" onclick="switchSubTool('stats')" data-subtool="stats">ÔøΩüìä Statistics</div>
        <div class="tool-menu-item" onclick="switchSubTool('escape')" data-subtool="escape">üîê Escape/Unescape</div>
      </div>

      <!-- Main Area -->
      <div class="tool-main-area">

        <!-- CSV Tool -->
        <div id="subtool-csv" class="tool-workspace active">
          <div class="tool-header">
            <h3>CSV to JSON</h3>
            <p>Convert CSV data to JSON array</p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">CSV Input</div>
              <textarea id="csv-input" placeholder="name,age\nAlice,30"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">JSON Output</div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="csvToJSONTool()">Convert</button>
              </div>
              <textarea id="csv-result" readonly placeholder="Result..."></textarea>
            </div>
          </div>
        </div>

        <!-- JS Obj Tool -->
        <div id="subtool-js-obj" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>JS Object to JSON</h3>
            <p>Convert relaxed JS objects to strict JSON</p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">JS Object Input</div>
              <textarea id="js-obj-input" placeholder="{ name: 'Alice', age: 30 }"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">JSON Output</div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="jsObjToJSON()">Convert</button>
              </div>
              <textarea id="js-obj-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- SQL Tool -->
        <div id="subtool-sql" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>SQL to JSON</h3>
            <p>Convert INSERT statements to JSON</p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">SQL Input</div>
              <textarea id="sql-input" placeholder="INSERT INTO users..."></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">JSON Output</div>
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="sqlToJSONTool()">Convert</button>
              </div>
              <textarea id="sql-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- Path Tool -->
        <div id="subtool-path" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>JSON Path Finder</h3>
            <p>Find path to a value</p>
          </div>
          <div class="tool-controls">
            <input type="text" id="search-value" placeholder="Value to search (e.g. Alice)">
            <button class="btn btn-primary" onclick="findPath()">Find Path</button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">JSON Input</div>
              <textarea id="path-json" placeholder='{"user": "Alice"}'></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">Paths Found</div>
              <textarea id="path-result" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- Diff Tool -->
        <div id="subtool-diff" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>JSON Diff</h3>
            <p>Compare two JSON objects</p>
          </div>
          <div class="tool-controls" style="margin-bottom: 0.5rem;">
            <button class="btn btn-primary" onclick="compareJSON()">Compare</button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">JSON 1</div>
              <textarea id="diff-json1" placeholder='{"a": 1}'></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">JSON 2</div>
              <textarea id="diff-json2" placeholder='{"a": 2}'></textarea>
            </div>
          </div>
          <div style="margin-top: 1rem;">
            <div class="editor-label">Diff Result</div>
            <div id="diff-result" class="result-box" style="display:none"></div>
          </div>
        </div>

        <!-- Stats Tool -->
        <div id="subtool-stats" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>JSON Statistics</h3>
            <p>Analyze structure</p>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">JSON Input</div>
              <textarea id="stats-json" placeholder='{"items": [1, 2, 3]}'></textarea>
            </div>
            <div class="single-editor">
              <div class="tool-controls" style="margin-bottom: 0.5rem;">
                <button class="btn btn-primary" onclick="analyzeJSON()">Analyze</button>
              </div>
              <div class="editor-label">Analysis</div>
              <div id="stats-result" class="result-box" style="display:none"></div>
            </div>
          </div>
        </div>

        <!-- Escape Tool -->
        <div id="subtool-escape" class="tool-workspace" style="display: none;">
          <div class="tool-header">
            <h3>Escape / Unescape</h3>
          </div>
          <div class="tool-controls" style="margin-bottom: 0.5rem;">
            <button class="btn" onclick="escapeJSON()">Escape</button>
            <button class="btn" onclick="unescapeJSON()">Unescape</button>
          </div>
          <div class="split-editor">
            <div class="single-editor">
              <div class="editor-label">Input String</div>
              <textarea id="escape-input"></textarea>
            </div>
            <div class="single-editor">
              <div class="editor-label">Result</div>
              <textarea id="escape-result" readonly></textarea>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script src="<%= rootPath %>assets/js/json-toolkit.js"></script>