<header class="site-header">
  <div class="header-inner container">
    <div class="nav-item logo-wrapper">
      <button class="logo dropdown-toggle" aria-haspopup="true" aria-expanded="false"
        style="background: none; border: none; padding: 0; cursor: pointer;">
        <span class="logo-icon">üõ†Ô∏è</span>
        <span class="logo-text">ZTools</span>
        <% if (category) { %>
          <span class="logo-sub">
            <%= category %>
          </span>
          <% } %>
      </button>

      <div class="dropdown-menu mega-menu">
        <% const catOrder=['job', 'finance' , 'text' , 'generator' , 'daily' , 'dev' ]; const catMap={ 'job' : { title:
          t('home.cats.job.title') || 'Job & Income' , icon: 'üõ†Ô∏è' }, 'finance' : { title: t('home.cats.finance.title')
          || 'Finance' , icon: 'üí∞' }, 'text' : { title: t('home.cats.text.title') || 'Text Tools' , icon: 'üìù'
          }, 'generator' : { title: t('home.cats.generator.title') || 'Generators' , icon: '‚öôÔ∏è' }, 'daily' : { title:
          t('home.cats.daily.title') || 'Daily Utilities' , icon: '‚òï' }, 'dev' : { title: t('home.cats.dev.title')
          || 'Dev Tools' , icon: 'üíª' } }; %>

          <% catOrder.forEach(catId=> {
            const catTools = tools.filter(t => t.category === catId && t.status === 'active');
            if (catTools.length === 0) return;
            %>
            <div class="mega-category-section">
              <button class="mega-header collapsible" aria-expanded="true">
                <div class="mega-title-wrap">
                  <span class="mega-icon">
                    <%= catMap[catId].icon %>
                  </span>
                  <%= catMap[catId].title %>
                    <span class="mega-count-badge">
                      <%= catTools.length %>
                    </span>
                </div>
                <span class="mega-caret">‚ñæ</span>
              </button>
              <div class="mega-links-grid">
                <% catTools.forEach(tool=> { %>
                  <a href="<%= rootPath %><%= locale %><%= tool.link %>" class="mega-link">
                    <span class="link-icon">
                      <%= tool.icon %>
                    </span>
                    <span class="link-text">
                      <%= t(tool.translationKey + '.title' ) %>
                    </span>
                  </a>
                  <% }); %>
              </div>
            </div>
            <% }); %>
      </div>
    </div>

    <div class="header-actions">
      <a href="https://github.com/ph4n4n/ztools.site-public" class="btn-icon github-link" target="_blank"
        rel="noopener noreferrer" title="View Source on GitHub">
        <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor"
          style="display: inline-block; vertical-align: middle;">
          <path
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
      <button id="search-btn" class="btn-icon" title="<%= t('nav.search_title') %>" aria-label="Search">
        üîç
      </button>
      <a href="<%= rootPath %><%= locale === 'vi' ? 'en' : 'vi' %>/<%= pageUrl %>" class="lang-switch"
        title="Switch Language">
        <%= locale==='vi' ? 'üá∫üá∏' : 'üáªüá≥' %>
      </a>
      <button id="theme-toggle" class="btn-icon" aria-label="Toggle Dark Mode">
        üåô
      </button>
    </div>
  </div>

  <!-- Search Overlay / Modal -->
  <div id="search-modal" class="search-modal">
    <div class="search-overlay"></div>
    <div class="search-container">
      <div class="search-header">
        <span class="search-icon">üîç</span>
        <input type="text" id="search-input" placeholder="<%= t('nav.search_placeholder') %>" autocomplete="off">
        <button id="close-search" class="close-search">&times;</button>
      </div>
      <div id="search-results" class="search-results">
        <!-- Results will be injected here -->
      </div>
      <div class="search-footer">
        <div class="search-hints">
          <span><kbd>‚Üµ</kbd> Select</span>
          <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
          <span><kbd>esc</kbd> Close</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Embed i18n data for client-side JS -->
  <script id="i18n-data" type="application/json">
    {
      "search_no_results": "<%= t('nav.search_no_results') %>"
    }
  </script>

  <!-- Embed tools data for client-side search -->
  <script id="tools-data" type="application/json">
    <% const translate = t; %>
    <%- JSON.stringify(tools.filter(t => t.status === 'active').map(tool => ({ 
      id: tool.id, 
      link: rootPath + locale + tool.link, 
      icon: tool.icon, 
      title: translate(tool.translationKey + '.title'),
      desc: translate(tool.translationKey + '.desc'),
      category: translate('home.cats.' + tool.category + '.title')
    }))) %>
  </script>
</header>