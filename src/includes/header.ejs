<header class="site-header">
  <div class="header-inner container">
    <div class="nav-item logo-wrapper">
      <button class="logo dropdown-toggle" aria-haspopup="true" aria-expanded="false"
        aria-label="<%= locale === 'vi' ? 'Menu danh má»¥c cÃ´ng cá»¥' : 'Tool categories menu' %>"
        style="background: none; border: none; padding: 0; cursor: pointer;">
        <span class="logo-icon" aria-hidden="true">ğŸ› ï¸</span>
        <span class="logo-text">ZTools</span>
        <% if (category) { %>
          <span class="logo-sub hide-mobile">
            <%= category %>
          </span>
          <% } %>
      </button>

      <div class="header-nav hide-mobile" style="margin-left: 1.5rem; display: flex; gap: 1rem;">
        <a href="<%= rootPath %><%= locale %>/bookmark-creator/" class="nav-link-prominent"
          style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--primary-color);">
          <span class="pulse-icon">ğŸ”–</span>
          <%= t('bookmarkCreator.title') %>
        </a>
      </div>

      <div class="dropdown-menu mega-menu">
        <div class="mega-menu-top">
          <a href="<%= rootPath %><%= locale %>/" class="mega-home-link">
            <span class="icon">ğŸ </span>
            <%= t('nav.home') %>
          </a>
          <a href="<%= rootPath %><%= locale %>/categories/" class="mega-home-link">
            <span class="icon">ğŸ—‚ï¸</span>
            <%= t('nav.menu_categories') %>
          </a>
          <a href="<%= rootPath %><%= locale %>/bookmark-creator/" class="mega-home-link">
            <span class="icon">ğŸ”–</span>
            <%= t('bookmarkCreator.title') || 'Bookmarks' %>
          </a>
        </div>
        <% const catOrder=['job', 'finance' , 'text' , 'generator' , 'daily' , 'dev' ]; const catMap={ 'job' : { title:
          t('home.cats.job.title') || 'Job & Income' , icon: 'ğŸ› ï¸' }, 'finance' : { title: t('home.cats.finance.title')
          || 'Finance' , icon: 'ğŸ’°' }, 'text' : { title: t('home.cats.text.title') || 'Text Tools' , icon: 'ğŸ“'
          }, 'generator' : { title: t('home.cats.generator.title') || 'Generators' , icon: 'âš™ï¸' }, 'daily' : { title:
          t('home.cats.daily.title') || 'Daily Utilities' , icon: 'â˜•' }, 'dev' : { title: t('home.cats.dev.title')
          || 'Dev Tools' , icon: 'ğŸ’»' } }; %>

          <% catOrder.forEach(catId=> {
            const catTools = tools.filter(t => t.category === catId && t.status === 'active');
            if (catTools.length === 0) return;
            %>
            <div class="mega-category-section">
              <button class="mega-header collapsible" aria-expanded="true">
                <div class="mega-title-wrap">
                  <span class="mega-icon" aria-hidden="true">
                    <%= catMap[catId].icon %>
                  </span>
                  <%= catMap[catId].title %>
                    <span class="mega-count-badge">
                      <%= catTools.length %>
                    </span>
                </div>
                <span class="mega-caret" aria-hidden="true">â–¾</span>
              </button>
              <div class="mega-links-grid">
                <% catTools.forEach(tool=> { %>
                  <a href="<%= rootPath %><%= locale %><%= tool.link %>" class="mega-link">
                    <span class="link-icon" aria-hidden="true">
                      <%= tool.icon %>
                    </span>
                    <span class="link-text">
                      <%= t(tool.translationKey + '.title' ) %>
                    </span>
                  </a>
                  <% }); %>
              </div>
            </div>
            <% }); %>
      </div>
    </div>

    <div class="header-actions">
      <!-- Desktop Search Box -->
      <div class="header-search-box desktop-only" id="header-search-box">
        <span class="search-box-icon">ğŸ”</span>
        <input type="text" class="header-search-input" placeholder="<%= t('nav.search_placeholder') %>" readonly>
        <kbd>Ctrl+K</kbd>
      </div>

      <a href="<%= rootPath %><%= locale %>/categories/" class="btn-icon" title="<%= t('nav.menu_categories') %>"
        aria-label="Categories">
        ğŸ—‚ï¸
      </a>

      <a href="<%= rootPath %><%= locale %>/bookmark-creator/" class="btn-icon" title="Bookmark Creator"
        aria-label="Bookmarks">
        ğŸ”–
      </a>

      <button id="search-btn-mobile" class="btn-icon search-trigger mobile-only" title="<%= t('nav.search_title') %>"
        aria-label="Search">
        ğŸ”
      </button>

      <a href="<%= rootPath %><%= locale === 'vi' ? 'en' : 'vi' %>/<%= pageUrl %>" class="lang-switch"
        title="Switch Language" aria-label="<%= locale === 'vi' ? 'Chuyá»ƒn sang Tiáº¿ng Anh' : 'Switch to Vietnamese' %>">
        <span aria-hidden="true">
          <%= locale==='vi' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡»ğŸ‡³' %>
        </span>
      </a>
      <button id="theme-toggle" class="btn-icon" aria-label="Toggle Dark Mode">
        ğŸŒ™
      </button>
    </div>
  </div>

  <!-- Search Overlay / Modal -->
  <div id="search-modal" class="search-modal">
    <div class="search-overlay"></div>
    <div class="search-container">
      <div class="search-header">
        <span class="search-icon" aria-hidden="true">ğŸ”</span>
        <input type="text" id="search-input" placeholder="<%= t('nav.search_placeholder') %>" autocomplete="off"
          aria-label="<%= t('nav.search_placeholder') %>">
        <button id="close-search" class="close-search"
          aria-label="<%= locale === 'vi' ? 'ÄÃ³ng tÃ¬m kiáº¿m' : 'Close search' %>">&times;</button>
      </div>
      <div id="search-results" class="search-results">
        <!-- Results will be injected here -->
      </div>
      <div class="search-footer">
        <div class="search-hints">
          <span><kbd>â†µ</kbd> Select</span>
          <span><kbd>â†‘â†“</kbd> Navigate</span>
          <span><kbd>esc</kbd> Close</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Embed i18n data for client-side JS -->
  <script id="i18n-data" type="application/json">
    {
      "search_no_results": "<%= t('nav.search_no_results') %>"
    }
  </script>

  <!-- Embed tools data for client-side search -->
  <script id="tools-data" type="application/json">
    <% const translate = t; %>
    <%- JSON.stringify(tools.filter(t => t.status === 'active').map(tool => ({ 
      id: tool.id, 
      link: rootPath + locale + tool.link, 
      icon: tool.icon, 
      title: translate(tool.translationKey + '.title'),
      desc: translate(tool.translationKey + '.desc'),
      category: translate('home.cats.' + tool.category + '.title')
    }))) %>
  </script>
</header>