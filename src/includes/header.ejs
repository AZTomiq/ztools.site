<header class="site-header">
  <div class="header-inner container">
    <div class="nav-item logo-wrapper">
      <button class="logo dropdown-toggle" aria-haspopup="true" aria-expanded="false"
        style="background: none; border: none; padding: 0; cursor: pointer;">
        <span class="logo-icon">üõ†Ô∏è</span>
        <span class="logo-text">ZTools</span>
        <% if (category) { %>
          <span class="logo-sub">
            <%= category %>
          </span>
          <% } %>
      </button>

      <div class="dropdown-menu mega-menu">
        <% const catOrder=['job', 'finance' , 'text' , 'generator' , 'daily' , 'dev' ]; const catMap={ 'job' : { title:
          t('home.cats.job.title') || 'Job & Income' , icon: 'üõ†Ô∏è' }, 'finance' : { title: t('home.cats.finance.title')
          || 'Finance' , icon: 'üí∞' }, 'text' : { title: t('home.cats.text.title') || 'Text Tools' , icon: 'üìù'
          }, 'generator' : { title: t('home.cats.generator.title') || 'Generators' , icon: '‚öôÔ∏è' }, 'daily' : { title:
          t('home.cats.daily.title') || 'Daily Utilities' , icon: '‚òï' }, 'dev' : { title: t('home.cats.dev.title')
          || 'Dev Tools' , icon: 'üíª' } }; %>

          <% catOrder.forEach(catId=> {
            const catTools = tools.filter(t => t.category === catId && t.status === 'active');
            if (catTools.length === 0) return;
            %>
            <div class="mega-category-section">
              <button class="mega-header collapsible" aria-expanded="true">
                <div class="mega-title-wrap">
                  <span class="mega-icon">
                    <%= catMap[catId].icon %>
                  </span>
                  <%= catMap[catId].title %>
                    <span class="mega-count-badge">
                      <%= catTools.length %>
                    </span>
                </div>
                <span class="mega-caret">‚ñæ</span>
              </button>
              <div class="mega-links-grid">
                <% catTools.forEach(tool=> { %>
                  <a href="<%= rootPath %><%= locale %><%= tool.link %>" class="mega-link">
                    <span class="link-icon">
                      <%= tool.icon %>
                    </span>
                    <span class="link-text">
                      <%= t(tool.translationKey + '.title' ) %>
                    </span>
                  </a>
                  <% }); %>
              </div>
            </div>
            <% }); %>
      </div>
    </div>

    <button id="search-btn" class="btn-icon" title="<%= t('nav.search_title') %>" aria-label="Search">
      üîç
    </button>
    <a href="<%= rootPath %><%= locale === 'vi' ? 'en' : 'vi' %>/<%= pageUrl %>"
      style="text-decoration: none; font-size: 1.2rem;" title="Switch Language">
      <%= locale==='vi' ? 'üá∫üá∏' : 'üáªüá≥' %>
    </a>
    <button id="theme-toggle" aria-label="Toggle Dark Mode">
      üåô
    </button>
  </div>
  </div>

  <!-- Search Overlay / Modal -->
  <div id="search-modal" class="search-modal">
    <div class="search-overlay"></div>
    <div class="search-container">
      <div class="search-header">
        <span class="search-icon">üîç</span>
        <input type="text" id="search-input" placeholder="<%= t('nav.search_placeholder') %>" autocomplete="off">
        <button id="close-search" class="close-search">&times;</button>
      </div>
      <div id="search-results" class="search-results">
        <!-- Results will be injected here -->
      </div>
      <div class="search-footer">
        <div class="search-hints">
          <span><kbd>‚Üµ</kbd> Select</span>
          <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
          <span><kbd>esc</kbd> Close</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Embed tools data for client-side search -->
  <script id="tools-data" type="application/json">
    <% const translate = t; %>
    <%- JSON.stringify(tools.filter(t => t.status === 'active').map(tool => ({ 
      id: tool.id, 
      link: rootPath + locale + tool.link, 
      icon: tool.icon, 
      title: translate(tool.translationKey + '.title'),
      desc: translate(tool.translationKey + '.desc'),
      category: translate('home.cats.' + tool.category + '.title')
    }))) %>
  </script>
</header>