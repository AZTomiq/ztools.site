let currentIndent=2,currentPath="",maximizedPanel=null,currentView="code",inputEditor=null,outputEditor=null,convertInputEditor=null,convertOutputEditor=null;function toggleOutputView(t){currentView=t;const e=document.getElementById("btn-view-code"),o=document.getElementById("btn-view-tree"),n=document.getElementById("monaco-output"),a=document.getElementById("tree-container"),i=document.getElementById("path-display"),s=document.getElementById("tree-controls");"code"===t?(e.classList.add("active"),o.classList.remove("active"),n.style.display="block",a.style.display="none",i.style.display="none",s&&(s.style.display="none"),outputEditor&&outputEditor.layout()):(e.classList.remove("active"),o.classList.add("active"),n.style.display="none",a.style.display="block",s&&(s.style.display="flex"))}function togglePanel(t){const e=document.getElementById("editor-layout"),o=document.getElementById("input-panel"),n=document.getElementById("output-panel");maximizedPanel===t?(o.classList.remove("maximized","minimized"),n.classList.remove("maximized","minimized"),e.classList.remove("has-maximized"),maximizedPanel=null):("input"===t?(o.classList.add("maximized"),o.classList.remove("minimized"),n.classList.add("minimized"),n.classList.remove("maximized")):(n.classList.add("maximized"),n.classList.remove("minimized"),o.classList.add("minimized"),o.classList.remove("maximized")),e.classList.add("has-maximized"),maximizedPanel=t),setTimeout(()=>{inputEditor&&inputEditor.layout(),outputEditor&&outputEditor.layout()},100)}function switchTab(t){document.querySelectorAll(".tab-panel").forEach(t=>{t.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active"),e.dataset.tab===t&&e.classList.add("active")}),document.getElementById(`tab-${t}`).classList.add("active"),"format"===t&&setTimeout(()=>{inputEditor&&inputEditor.layout(),outputEditor&&outputEditor.layout()},50)}function parseRelaxedJSON(t){try{return JSON.parse(t)}catch(e){try{return new Function("return "+t)()}catch(t){throw new Error("Invalid JSON")}}}function updateIndent(){const t=document.getElementById("indent-size");currentIndent="tab"===t.value?"\t":parseInt(t.value)}function formatJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim(),e=document.getElementById("tree-container");if(t)try{const o=parseRelaxedJSON(t),n=JSON.stringify(o,null,currentIndent);outputEditor&&outputEditor.setValue(n),e.innerHTML="",buildTree(o,e,""),updateStats(n),showValidation("âœ… Valid JSON! Formatted successfully","success")}catch(t){showValidation(`âŒ Invalid JSON: ${t.message}`,"error")}else showValidation("Please enter JSON to format","error")}function minifyJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim(),e=document.getElementById("tree-container");if(t)try{const o=parseRelaxedJSON(t),n=JSON.stringify(o);outputEditor&&outputEditor.setValue(n),e.innerHTML="",buildTree(o,e,""),updateStats(n),showValidation(`âœ… Minified! Reduced from ${t.length} to ${n.length} chars`,"success")}catch(t){showValidation(`âŒ Invalid JSON: ${t.message}`,"error")}else showValidation("Please enter JSON to minify","error")}function validateJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim();if(t)try{JSON.parse(t),showValidation("âœ… Valid Strict JSON!","success")}catch(e){try{parseRelaxedJSON(t),showValidation("âš ï¸ Valid JS Object (Relaxed JSON), format it to convert to Strict JSON.","warning")}catch(t){showValidation(`âŒ Invalid JSON: ${e.message}`,"error")}}else showValidation("Please enter JSON to validate","error")}function copyJSON(){if(!outputEditor)return;const t=outputEditor.getValue();t?navigator.clipboard.writeText(t).then(()=>{showValidation("ðŸ“‹ Copied to clipboard!","success")}):showValidation("Nothing to copy!","error")}function clearJSON(){inputEditor&&inputEditor.setValue(""),outputEditor&&outputEditor.setValue(""),document.getElementById("tree-container").innerHTML='<div class="tree-placeholder">Format JSON to see tree view</div>',document.getElementById("validation-result").style.display="none",document.getElementById("output-stats").textContent=""}function loadSample(){const t={name:"John Doe",age:30,email:"john@example.com",address:{street:"123 Main St",city:"Hanoi"},active:!0};inputEditor&&(inputEditor.setValue(JSON.stringify(t,null,2)),formatJSON())}function showValidation(t,e){const o=document.getElementById("validation-result");o.textContent=t,o.className=`validation-result show ${e}`}function updateStats(t){const e=document.getElementById("output-stats"),o=t.split("\n").length,n=t.length;e.textContent=`${o} lines, ${n} chars`}function toggleOutputView(t){currentView=t;const e=document.getElementById("btn-view-code"),o=document.getElementById("btn-view-tree"),n=document.getElementById("monaco-output"),a=document.getElementById("tree-container"),i=document.getElementById("path-display"),s=document.getElementById("tree-controls");"code"===t?(e.classList.add("active"),o.classList.remove("active"),n.style.display="block",a.style.display="none",i.style.display="none",s&&(s.style.display="none"),outputEditor&&outputEditor.layout()):(e.classList.remove("active"),o.classList.add("active"),n.style.display="none",a.style.display="block",s&&(s.style.display="flex"))}function togglePanel(t){const e=document.getElementById("editor-layout"),o=document.getElementById("input-panel"),n=document.getElementById("output-panel");maximizedPanel===t?(o.classList.remove("maximized","minimized"),n.classList.remove("maximized","minimized"),e.classList.remove("has-maximized"),maximizedPanel=null):("input"===t?(o.classList.add("maximized"),o.classList.remove("minimized"),n.classList.add("minimized"),n.classList.remove("maximized")):(n.classList.add("maximized"),n.classList.remove("minimized"),o.classList.add("minimized"),o.classList.remove("maximized")),e.classList.add("has-maximized"),maximizedPanel=t),setTimeout(()=>{inputEditor&&inputEditor.layout(),outputEditor&&outputEditor.layout(),convertInputEditor&&convertInputEditor.layout(),convertOutputEditor&&convertOutputEditor.layout()},100)}function switchTab(t){document.querySelectorAll(".tab-panel").forEach(t=>{t.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active"),e.dataset.tab===t&&e.classList.add("active")}),document.getElementById(`tab-${t}`).classList.add("active"),setTimeout(()=>{"format"===t?(inputEditor&&inputEditor.layout(),outputEditor&&outputEditor.layout()):"convert"===t&&(convertInputEditor&&convertInputEditor.layout(),convertOutputEditor&&convertOutputEditor.layout())},50)}function parseRelaxedJSON(t){try{return JSON.parse(t)}catch(e){try{return new Function("return "+t)()}catch(t){throw new Error("Invalid JSON")}}}function updateIndent(){const t=document.getElementById("indent-size");currentIndent="tab"===t.value?"\t":parseInt(t.value)}function formatJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim(),e=document.getElementById("tree-container");if(t)try{const o=parseRelaxedJSON(t),n=JSON.stringify(o,null,currentIndent);outputEditor&&outputEditor.setValue(n),e.innerHTML="",buildTree(o,e,""),updateStats(n),showValidation("âœ… Valid JSON! Formatted successfully","success")}catch(t){showValidation(`âŒ Invalid JSON: ${t.message}`,"error")}else showValidation("Please enter JSON to format","error")}function minifyJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim(),e=document.getElementById("tree-container");if(t)try{const o=parseRelaxedJSON(t),n=JSON.stringify(o);outputEditor&&outputEditor.setValue(n),e.innerHTML="",buildTree(o,e,""),updateStats(n),showValidation(`âœ… Minified! Reduced from ${t.length} to ${n.length} chars`,"success")}catch(t){showValidation(`âŒ Invalid JSON: ${t.message}`,"error")}else showValidation("Please enter JSON to minify","error")}function validateJSON(){if(!inputEditor)return;const t=inputEditor.getValue().trim();if(t)try{JSON.parse(t),showValidation("âœ… Valid Strict JSON!","success")}catch(e){try{parseRelaxedJSON(t),showValidation("âš ï¸ Valid JS Object (Relaxed JSON), format it to convert to Strict JSON.","warning")}catch(t){showValidation(`âŒ Invalid JSON: ${e.message}`,"error")}}else showValidation("Please enter JSON to validate","error")}function copyJSON(){if(!outputEditor)return;const t=outputEditor.getValue();t?copyTextToClipboard(t,()=>showValidation("ðŸ“‹ Copied to clipboard!","success")):showValidation("Nothing to copy!","error")}function clearJSON(){inputEditor&&inputEditor.setValue(""),outputEditor&&outputEditor.setValue(""),document.getElementById("tree-container").innerHTML='<div class="tree-placeholder">Format JSON to see tree view</div>',document.getElementById("validation-result").style.display="none",document.getElementById("output-stats").textContent=""}function loadSample(){const t={name:"John Doe",age:30,email:"john@example.com",address:{street:"123 Main St",city:"Hanoi"},active:!0};inputEditor&&(inputEditor.setValue(JSON.stringify(t,null,2)),formatJSON())}function showValidation(t,e){const o=document.getElementById("validation-result");o.textContent=t,o.className=`validation-result show ${e}`}function updateStats(t){const e=document.getElementById("output-stats"),o=t.split("\n").length,n=t.length;e.textContent=`${o} lines, ${n} chars`}function buildTree(t,e,o){if(null===t){const t=document.createElement("span");return t.className="tree-value null",t.textContent="null",void e.appendChild(t)}if("object"!=typeof t){const o=document.createElement("span");return o.className="tree-value "+typeof t,o.textContent="string"==typeof t?`"${t}"`:String(t),void e.appendChild(o)}const n=Array.isArray(t);(n?t.map((t,e)=>[e,t]):Object.entries(t)).forEach(([a,i])=>{const s=document.createElement("div");s.className="tree-node";const r=o?Array.isArray(t)?`${o}[${a}]`:`${o}.${a}`:String(a),l="object"==typeof i&&null!==i;if(l){const t=document.createElement("span");t.className="tree-toggle",t.textContent="â–¼",t.onclick=()=>toggleNode(t),s.appendChild(t)}else{const t=document.createElement("span");t.style.display="inline-block",t.style.width="1rem",s.appendChild(t)}const c=document.createElement("span");if(c.className="tree-key",c.textContent=n?`[${a}]: `:`${a}: `,c.onclick=()=>showPath(r),s.appendChild(c),l){const t=document.createElement("div");t.className="tree-children",buildTree(i,t,r),s.appendChild(t)}else buildTree(i,s,r);e.appendChild(s)})}function toggleNode(t){const e=t.parentElement.querySelector(".tree-children");e.classList.contains("collapsed")?(e.classList.remove("collapsed"),t.textContent="â–¼"):(e.classList.add("collapsed"),t.textContent="â–¶")}function showPath(t){currentPath=t;const e=document.getElementById("path-display");e.textContent=`Path: ${t}`,e.classList.add("show"),e.style.display="block"}function copyPath(){currentPath&&copyTextToClipboard(currentPath,()=>showValidation(`Path copied: ${currentPath}`,"success"))}function updateConvertLanguage(){if(!convertOutputEditor)return;const t={xml:"xml",yaml:"yaml",csv:"plaintext",typescript:"typescript",go:"go",java:"java",protobuf:"cpp"}[document.getElementById("convert-format").value]||"plaintext";monaco.editor.setModelLanguage(convertOutputEditor.getModel(),t)}function convertJSON(){if(!convertInputEditor||!convertOutputEditor)return;const t=convertInputEditor.getValue().trim(),e=document.getElementById("convert-format").value;if(t)try{const o=parseRelaxedJSON(t);let n="";switch(e){case"xml":n=jsonToXML(o);break;case"yaml":n=jsonToYAML(o);break;case"csv":n=jsonToCSV(o);break;case"typescript":n=jsonToTypeScript(o);break;case"go":n=jsonToGo(o);break;case"java":n=jsonToJava(o);break;case"protobuf":n=jsonToProtobuf(o)}convertOutputEditor.setValue(n),updateConvertLanguage()}catch(t){convertOutputEditor.setValue(`Error: ${t.message}`)}else convertOutputEditor.setValue("Please enter JSON to convert")}function jsonToXML(t,e=0){const o="  ".repeat(e);let n="";for(const[a,i]of Object.entries(t))Array.isArray(i)?i.forEach(t=>{n+=`${o}<${a}>\n`,n+="object"==typeof t?jsonToXML(t,e+1):`${o}  ${t}\n`,n+=`${o}</${a}>\n`}):"object"==typeof i&&null!==i?(n+=`${o}<${a}>\n`,n+=jsonToXML(i,e+1),n+=`${o}</${a}>\n`):n+=`${o}<${a}>${i}</${a}>\n`;return n}function jsonToYAML(t,e=0){const o="  ".repeat(e);let n="";for(const[a,i]of Object.entries(t))if(Array.isArray(i))n+=`${o}${a}:\n`,i.forEach(t=>{"object"==typeof t?(n+=`${o}  -\n`,n+=jsonToYAML(t,e+2)):n+=`${o}  - ${t}\n`});else if("object"==typeof i&&null!==i)n+=`${o}${a}:\n`,n+=jsonToYAML(i,e+1);else{n+=`${o}${a}: ${"string"==typeof i?`"${i}"`:i}\n`}return n}function jsonToCSV(t){if(Array.isArray(t)){if(0===t.length)return"";if("object"!=typeof t[0])return"value\n"+t.join("\n");const e=Object.keys(t[0]);let o=e.join(",")+"\n";return t.forEach(t=>{const n=e.map(e=>{const o=t[e];return"string"==typeof o&&o.includes(",")?`"${o}"`:o});o+=n.join(",")+"\n"}),o}return"key,value\n"+Object.entries(t).map(([t,e])=>`${t},${e}`).join("\n")}function jsonToTypeScript(t,e="Root"){let o=`interface ${e} {\n`;for(const[e,n]of Object.entries(t))o+=`  ${e}: ${getTypeScriptType(n)};\n`;return o+="}\n",o}function getTypeScriptType(t){return null===t?"null":Array.isArray(t)?0===t.length?"any[]":getTypeScriptType(t[0])+"[]":"object"==typeof t?"object":typeof t}function jsonToGo(t,e="Root"){let o=`type ${e} struct {\n`;for(const[e,n]of Object.entries(t)){o+=`    ${e.charAt(0).toUpperCase()+e.slice(1)} ${getGoType(n)} \`json:"${e}"\`\n`}return o+="}\n",o}function getGoType(t){return null===t?"interface{}":Array.isArray(t)?0===t.length?"[]interface{}":"[]"+getGoType(t[0]):"object"==typeof t?"map[string]interface{}":"number"==typeof t?Number.isInteger(t)?"int":"float64":"boolean"==typeof t?"bool":"string"}function jsonToJava(t,e="Root"){let o=`public class ${e} {\n`;for(const[e,n]of Object.entries(t))o+=`    private ${getJavaType(n)} ${e};\n`;return o+="}\n",o}function getJavaType(t){return null===t?"Object":Array.isArray(t)?0===t.length?"List<Object>":"List<"+getJavaType(t[0])+">":"object"==typeof t?"Map<String, Object>":"number"==typeof t?Number.isInteger(t)?"Integer":"Double":"boolean"==typeof t?"Boolean":"String"}function jsonToProtobuf(t,e="Root"){let o=[];return function t(e,n){let a=[`message ${e} {`],i=1;for(const[e,o]of Object.entries(n)){let n="string",s="";if(null===o)n="string";else if(Array.isArray(o))if(s="repeated ",o.length>0){let a=o[0];if("object"==typeof a&&null!==a){const o=e.charAt(0).toUpperCase()+e.slice(1);t(o,a),n=o}else n=getProtoType(a)}else n="string";else if("object"==typeof o){const a=e.charAt(0).toUpperCase()+e.slice(1);t(a,o),n=a}else n=getProtoType(o);a.push(`  ${s}${n} ${e} = ${i};`),i++}a.push("}"),o.push(a.join("\n"))}(e,t),'syntax = "proto3";\n\n'+o.reverse().join("\n\n")}function getProtoType(t){return"number"==typeof t?Number.isInteger(t)?"int32":"double":"boolean"==typeof t?"bool":"string"}function copyConverted(){if(!convertOutputEditor)return;const t=convertOutputEditor.getValue();t&&!t.includes("Error:")&&copyTextToClipboard(t,()=>alert("Copied!"))}function csvToJSONTool(){const t=document.getElementById("csv-input").value.trim(),e=document.getElementById("csv-result");if(!t)return e.textContent="Enter CSV data",void e.classList.add("show");try{const o=t.split("\n");if(o.length<2)throw new Error("CSV must have header and data row");const n=o[0].split(",").map(t=>t.trim().replace(/^"|"$/g,"")),a=[];for(let t=1;t<o.length;t++){if(!o[t].trim())continue;const e=o[t].split(",").map(t=>t.trim().replace(/^"|"$/g,"")),i={};n.forEach((t,o)=>{let n=e[o];n&&!isNaN(n)&&(n=Number(n)),"true"===n&&(n=!0),"false"===n&&(n=!1),i[t]=n}),a.push(i)}e.textContent=JSON.stringify(a,null,2),e.classList.add("show")}catch(t){e.textContent=`Error: ${t.message}`,e.classList.add("show")}}function jsObjToJSON(){const t=document.getElementById("js-obj-input").value.trim(),e=document.getElementById("js-obj-result");if(t)try{const o=new Function("return "+t)();e.textContent=JSON.stringify(o,null,2),e.classList.add("show")}catch(t){e.textContent=`Error: ${t.message}`,e.classList.add("show")}}function sqlToJSONTool(){const t=document.getElementById("sql-input").value.trim(),e=document.getElementById("sql-result");if(t)try{const o=/INSERT\s+INTO\s+[\w`"'.]+\s*\(([^)]+)\)\s+VALUES\s*\(([^)]+)\);?/gim,n=[...t.matchAll(o)];if(0===n.length)throw new Error("No valid INSERT statements");const a=n.map(t=>{const e=t[1].split(",").map(t=>t.trim().replace(/[`"']/g,"")),o=t[2].split(",").map(t=>{let e=t.trim();return e.startsWith("'")||e.startsWith('"')?e=e.substring(1,e.length-1):isNaN(e)?"null"===e.toLowerCase()?e=null:"true"===e.toLowerCase()?e=!0:"false"===e.toLowerCase()&&(e=!1):e=Number(e),e}),n={};return e.forEach((t,e)=>n[t]=o[e]),n});e.textContent=JSON.stringify(a,null,2),e.classList.add("show")}catch(t){e.textContent=`Error: ${t.message}`,e.classList.add("show")}}function findPath(){const t=document.getElementById("path-json").value,e=document.getElementById("search-value").value,o=document.getElementById("path-result");if(t&&e)try{const n=parseRelaxedJSON(t),a=[];!function t(o,n){for(const[i,s]of Object.entries(o)){const o=n?`${n}.${i}`:i;String(s)===e&&a.push(o),"object"==typeof s&&s&&t(s,o)}}(n,""),o.textContent=a.length?a.join("\n"):"Not found",o.classList.add("show"),o.style.display="block"}catch(t){o.textContent=t.message,o.classList.add("show")}}function compareJSON(){const t=document.getElementById("diff-json1").value,e=document.getElementById("diff-json2").value,o=document.getElementById("diff-result");if(t&&e)try{const n=parseRelaxedJSON(t),a=parseRelaxedJSON(e);JSON.stringify(n)===JSON.stringify(a)?o.textContent="Identical":o.textContent="Objects differ (Detailed diff skipped for brevity)",o.classList.add("show"),o.style.display="block"}catch(t){o.textContent=t.message,o.classList.add("show")}}function analyzeJSON(){const t=document.getElementById("stats-json").value,e=document.getElementById("stats-result");if(t)try{const o=parseRelaxedJSON(t),n={k:0,v:0,d:0};!function t(e,o){n.d=Math.max(n.d,o),"object"==typeof e&&e&&Object.entries(e).forEach(([e,a])=>{n.k++,n.v++,t(a,o+1)})}(o,1),e.textContent=`Keys: ${n.k}, Values: ${n.v}, Depth: ${n.d}`,e.classList.add("show"),e.style.display="block"}catch(t){e.textContent=t.message}}function escapeJSON(){document.getElementById("escape-result").textContent=JSON.stringify(document.getElementById("escape-input").value),document.getElementById("escape-result").style.display="block"}function unescapeJSON(){try{document.getElementById("escape-result").textContent=JSON.parse(document.getElementById("escape-input").value)}catch(t){document.getElementById("escape-result").textContent=t.message}document.getElementById("escape-result").style.display="block"}function copyTextToClipboard(t,e){t&&(navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(e).catch(()=>fallbackCopyExec(t,e)):fallbackCopyExec(t,e))}function fallbackCopyExec(t,e){const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy"),e&&e()}catch(t){console.error("Copy failed",t),alert("Failed to copy. Please copy manually.")}document.body.removeChild(o)}function switchSubTool(t){document.querySelectorAll(".tool-menu-item").forEach(t=>t.classList.remove("active"));const e=document.querySelector(`.tool-menu-item[data-subtool="${t}"]`);e&&e.classList.add("active"),document.querySelectorAll(".tool-workspace").forEach(t=>{t.style.display="none",t.classList.remove("active")});const o=document.getElementById(`subtool-${t}`);o&&(o.style.display="flex",o.classList.add("active"))}require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs"}}),require(["vs/editor/editor.main"],function(){inputEditor=monaco.editor.create(document.getElementById("monaco-input"),{value:'{\n  "name": "John Doe",\n  "age": 30,\n  "city": "Hanoi"\n}',language:"json",theme:"vs-dark",minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,fontSize:14}),outputEditor=monaco.editor.create(document.getElementById("monaco-output"),{value:"",language:"json",theme:"vs-dark",readOnly:!0,minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,fontSize:14}),convertInputEditor=monaco.editor.create(document.getElementById("monaco-convert-input"),{value:'{\n  "name": "Product",\n  "price": 99.99\n}',language:"json",theme:"vs-dark",minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,fontSize:14}),convertOutputEditor=monaco.editor.create(document.getElementById("monaco-convert-output"),{value:"",language:"xml",theme:"vs-dark",readOnly:!0,minimap:{enabled:!1},automaticLayout:!0,scrollBeyondLastLine:!1,fontSize:14})}),window.switchSubTool=switchSubTool,window.toggleOutputView=toggleOutputView,window.togglePanel=togglePanel,window.switchTab=switchTab,window.formatJSON=formatJSON,window.minifyJSON=minifyJSON,window.validateJSON=validateJSON,window.copyJSON=copyJSON,window.clearJSON=clearJSON,window.loadSample=loadSample,window.updateIndent=updateIndent,window.copyPath=copyPath,window.convertJSON=convertJSON,window.copyConverted=copyConverted,window.csvToJSONTool=csvToJSONTool,window.jsObjToJSON=jsObjToJSON,window.sqlToJSONTool=sqlToJSONTool,window.findPath=findPath,window.compareJSON=compareJSON,window.analyzeJSON=analyzeJSON,window.escapeJSON=escapeJSON,window.unescapeJSON=unescapeJSON,window.expandAll=()=>document.querySelectorAll(".tree-children").forEach(t=>t.classList.remove("collapsed")),window.collapseAll=()=>document.querySelectorAll(".tree-children").forEach(t=>t.classList.add("collapsed"));