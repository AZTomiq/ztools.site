const INSURANCE_RATES={employee:{bhxh:.08,bhyt:.015,bhtn:.01},employer:{bhxh:.175,bhyt:.03,bhtn:.01}},CAPS={bhxh_bhyt:468e5,bhtn_multiplier:20},MIN_WAGES={1:496e4,2:441e4,3:386e4,4:345e4},PENSION_RATES={base:.45,additional:.02,max:.75,min_years:20};function parseNumber(e){return e&&parseFloat(e.toString().replace(/[^\d.-]/g,""))||0}function formatCurrency(e){return 0===e?"0 đ":Math.round(e).toLocaleString("vi-VN")+" đ"}function formatNumberInput(e){e.addEventListener("input",function(e){let t=e.target.value.replace(/[^\d]/g,"");t&&(e.target.value=parseInt(t).toLocaleString("vi-VN"))}),e.addEventListener("blur",function(e){e.target.value||(e.target.value="0")})}function switchTab(e){document.querySelectorAll(".tab-panel").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.getElementById(`tab-${e}`).classList.add("active"),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".result-section").forEach(e=>{e.classList.remove("show")})}window.switchTab=switchTab;const salaryInput=document.getElementById("salary"),regionSelect=document.getElementById("region"),insuranceTypeSelect=document.getElementById("insurance-type"),btnCalculateContribution=document.getElementById("btn-calculate-contribution"),btnResetContribution=document.getElementById("btn-reset-contribution"),contributionResults=document.getElementById("contribution-results"),avgSalaryInput=document.getElementById("avg-salary"),yearsContributedInput=document.getElementById("years-contributed"),genderSelect=document.getElementById("gender"),btnCalculatePension=document.getElementById("btn-calculate-pension"),btnResetPension=document.getElementById("btn-reset-pension"),pensionResults=document.getElementById("pension-results"),onetimeSalaryInput=document.getElementById("onetime-salary"),onetimeYearsInput=document.getElementById("onetime-years"),btnCalculateOnetime=document.getElementById("btn-calculate-onetime"),btnResetOnetime=document.getElementById("btn-reset-onetime"),onetimeResults=document.getElementById("onetime-results");function calculateContribution(){const e=parseNumber(salaryInput.value),t=parseInt(regionSelect.value);if(0===e)return alert("Vui lòng nhập lương đóng BHXH!"),void salaryInput.focus();const n=CAPS.bhxh_bhyt,o=MIN_WAGES[t]*CAPS.bhtn_multiplier,r=Math.min(e,n),a=Math.min(e,o),l=r*INSURANCE_RATES.employee.bhxh,u=r*INSURANCE_RATES.employee.bhyt,i=a*INSURANCE_RATES.employee.bhtn,s=l+u+i,m=r*INSURANCE_RATES.employer.bhxh,c=r*INSURANCE_RATES.employer.bhyt,d=a*INSURANCE_RATES.employer.bhtn,y=m+c+d,E=e-s,I=e+y;document.getElementById("employee-bhxh").textContent=formatCurrency(l),document.getElementById("employee-bhyt").textContent=formatCurrency(u),document.getElementById("employee-bhtn").textContent=formatCurrency(i),document.getElementById("employee-total").textContent=formatCurrency(s),document.getElementById("employer-bhxh").textContent=formatCurrency(m),document.getElementById("employer-bhyt").textContent=formatCurrency(c),document.getElementById("employer-bhtn").textContent=formatCurrency(d),document.getElementById("employer-total").textContent=formatCurrency(y),document.getElementById("salary-before").textContent=formatCurrency(e),document.getElementById("salary-after").textContent=formatCurrency(E),document.getElementById("total-cost").textContent=formatCurrency(I),contributionResults.classList.add("show"),contributionResults.scrollIntoView({behavior:"smooth",block:"nearest"})}function resetContribution(){salaryInput.value="",regionSelect.value="1",insuranceTypeSelect.value="mandatory",contributionResults.classList.remove("show")}function calculatePension(){const e=parseNumber(avgSalaryInput.value),t=parseFloat(yearsContributedInput.value)||0;if(0===e)return alert("Vui lòng nhập lương bình quân!"),void avgSalaryInput.focus();if(t<PENSION_RATES.min_years)return alert(`Cần đóng tối thiểu ${PENSION_RATES.min_years} năm để được hưởng lương hưu!`),void yearsContributedInput.focus();let n=PENSION_RATES.base;if(t>PENSION_RATES.min_years){n+=(t-PENSION_RATES.min_years)*PENSION_RATES.additional}n=Math.min(n,PENSION_RATES.max);const o=e*n,r=12*o,a=10*r,l=20*r;document.getElementById("pension-avg-salary").textContent=formatCurrency(e),document.getElementById("pension-years").textContent=t+" năm",document.getElementById("pension-rate").textContent=(100*n).toFixed(1)+"%",document.getElementById("pension-amount").textContent=formatCurrency(o),document.getElementById("pension-yearly").textContent=formatCurrency(r),document.getElementById("pension-10years").textContent=formatCurrency(a),document.getElementById("pension-20years").textContent=formatCurrency(l),pensionResults.classList.add("show"),pensionResults.scrollIntoView({behavior:"smooth",block:"nearest"})}function resetPension(){avgSalaryInput.value="",yearsContributedInput.value="",genderSelect.value="male",pensionResults.classList.remove("show")}function calculateOnetime(){const e=parseNumber(onetimeSalaryInput.value),t=parseFloat(onetimeYearsInput.value)||0;if(0===e)return alert("Vui lòng nhập lương bình quân 6 tháng!"),void onetimeSalaryInput.focus();if(0===t)return alert("Vui lòng nhập số năm đã đóng BHXH!"),void onetimeYearsInput.focus();if(t>=20)return alert("BHXH một lần chỉ áp dụng cho người đóng dưới 20 năm!"),void onetimeYearsInput.focus();const n=1.5*t,o=e*n;document.getElementById("onetime-avg").textContent=formatCurrency(e),document.getElementById("onetime-years-display").textContent=t+" năm",document.getElementById("onetime-coefficient").textContent=n.toFixed(1)+" tháng",document.getElementById("onetime-amount").textContent=formatCurrency(o),onetimeResults.classList.add("show"),onetimeResults.scrollIntoView({behavior:"smooth",block:"nearest"})}function resetOnetime(){onetimeSalaryInput.value="",onetimeYearsInput.value="",onetimeResults.classList.remove("show")}[salaryInput,avgSalaryInput,onetimeSalaryInput].forEach(formatNumberInput),btnCalculateContribution.addEventListener("click",calculateContribution),btnResetContribution.addEventListener("click",resetContribution),btnCalculatePension.addEventListener("click",calculatePension),btnResetPension.addEventListener("click",resetPension),btnCalculateOnetime.addEventListener("click",calculateOnetime),btnResetOnetime.addEventListener("click",resetOnetime),document.getElementById("contribution-form").addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),calculateContribution())}),document.getElementById("pension-form").addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),calculatePension())}),document.getElementById("onetime-form").addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),calculateOnetime())});