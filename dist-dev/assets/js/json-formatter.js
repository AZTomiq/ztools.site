let currentIndent=2,currentPath="",maximizedPanel=null,currentView="code";function toggleOutputView(e){currentView=e;const t=document.getElementById("btn-view-code"),n=document.getElementById("btn-view-tree"),o=document.getElementById("json-output"),s=document.getElementById("tree-container"),a=document.getElementById("path-display");"code"===e?(t.classList.add("active"),n.classList.remove("active"),o.classList.add("active"),s.classList.remove("active"),s.style.display="none",a.style.display="none"):(t.classList.remove("active"),n.classList.add("active"),o.classList.remove("active"),s.classList.add("active"),s.style.display="block")}function togglePanel(e){const t=document.getElementById("editor-layout"),n=document.getElementById("input-panel"),o=document.getElementById("output-panel");maximizedPanel===e?(n.classList.remove("maximized","minimized"),o.classList.remove("maximized","minimized"),t.classList.remove("has-maximized"),maximizedPanel=null):("input"===e?(n.classList.add("maximized"),n.classList.remove("minimized"),o.classList.add("minimized"),o.classList.remove("maximized")):(o.classList.add("maximized"),o.classList.remove("minimized"),n.classList.add("minimized"),n.classList.remove("maximized")),t.classList.add("has-maximized"),maximizedPanel=e)}function switchTab(e){document.querySelectorAll(".tab-panel").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tab-btn").forEach(t=>{t.classList.remove("active"),t.dataset.tab===e&&t.classList.add("active")}),document.getElementById(`tab-${e}`).classList.add("active")}function parseRelaxedJSON(e){try{return JSON.parse(e)}catch(t){try{return new Function("return "+e)()}catch(e){throw new Error("Invalid JSON")}}}function updateIndent(){const e=document.getElementById("indent-size");currentIndent="tab"===e.value?"\t":parseInt(e.value)}function formatJSON(){const e=document.getElementById("json-input").value.trim(),t=document.getElementById("json-output"),n=document.getElementById("tree-container");if(e)try{const o=parseRelaxedJSON(e),s=JSON.stringify(o,null,currentIndent);t.value=s,n.innerHTML="",buildTree(o,n,""),updateStats(s),showValidation("âœ… Valid JSON! Formatted successfully","success")}catch(e){showValidation(`âŒ Invalid JSON: ${e.message}`,"error")}else showValidation("Please enter JSON to format","error")}function minifyJSON(){const e=document.getElementById("json-input").value.trim(),t=document.getElementById("json-output"),n=document.getElementById("tree-container");if(e)try{const o=parseRelaxedJSON(e),s=JSON.stringify(o);t.value=s,n.innerHTML="",buildTree(o,n,""),updateStats(s),showValidation(`âœ… Minified! Reduced from ${e.length} to ${s.length} chars`,"success")}catch(e){showValidation(`âŒ Invalid JSON: ${e.message}`,"error")}else showValidation("Please enter JSON to minify","error")}function validateJSON(){const e=document.getElementById("json-input").value.trim();if(e)try{JSON.parse(e),showValidation("âœ… Valid Strict JSON!","success")}catch(t){try{parseRelaxedJSON(e),showValidation("âš ï¸ Valid JS Object (Relaxed JSON), format it to convert to Strict JSON.","warning")}catch(e){showValidation(`âŒ Invalid JSON: ${t.message}`,"error")}}else showValidation("Please enter JSON to validate","error")}function copyJSON(){const e=document.getElementById("json-output").value;e?navigator.clipboard.writeText(e).then(()=>{showValidation("ðŸ“‹ Copied to clipboard!","success")}):showValidation("Nothing to copy!","error")}function clearJSON(){document.getElementById("json-input").value="",document.getElementById("json-output").value="",document.getElementById("tree-container").innerHTML='<div class="tree-placeholder">Format JSON to see tree view</div>',document.getElementById("validation-result").style.display="none",document.getElementById("output-stats").textContent=""}function loadSample(){document.getElementById("json-input").value=JSON.stringify({name:"John Doe",age:30,email:"john@example.com",address:{street:"123 Main St",city:"Hanoi"},active:!0},null,2),formatJSON()}function showValidation(e,t){const n=document.getElementById("validation-result");n.textContent=e,n.className=`validation-result show ${t}`}function updateStats(e){const t=document.getElementById("output-stats"),n=e.split("\n").length,o=e.length;t.textContent=`${n} lines, ${o} chars`}function buildTree(e,t,n){if(null===e){const e=document.createElement("span");return e.className="tree-value null",e.textContent="null",void t.appendChild(e)}if("object"!=typeof e){const n=document.createElement("span");return n.className="tree-value "+typeof e,n.textContent="string"==typeof e?`"${e}"`:String(e),void t.appendChild(n)}const o=Array.isArray(e);(o?e.map((e,t)=>[t,e]):Object.entries(e)).forEach(([s,a])=>{const i=document.createElement("div");i.className="tree-node";const c=n?Array.isArray(e)?`${n}[${s}]`:`${n}.${s}`:String(s),l="object"==typeof a&&null!==a;if(l){const e=document.createElement("span");e.className="tree-toggle",e.textContent="â–¼",e.onclick=()=>toggleNode(e),i.appendChild(e)}else{const e=document.createElement("span");e.style.display="inline-block",e.style.width="1rem",i.appendChild(e)}const r=document.createElement("span");if(r.className="tree-key",r.textContent=o?`[${s}]: `:`${s}: `,r.onclick=()=>showPath(c),i.appendChild(r),l){const e=document.createElement("div");e.className="tree-children",buildTree(a,e,c),i.appendChild(e)}else buildTree(a,i,c);t.appendChild(i)})}function toggleNode(e){const t=e.parentElement.querySelector(".tree-children");t.classList.contains("collapsed")?(t.classList.remove("collapsed"),e.textContent="â–¼"):(t.classList.add("collapsed"),e.textContent="â–¶")}function showPath(e){currentPath=e;const t=document.getElementById("path-display");t.textContent=`Path: ${e}`,t.classList.add("show"),t.style.display="block"}function copyPath(){currentPath&&navigator.clipboard.writeText(currentPath).then(()=>{})}function convertJSON(){const e=document.getElementById("convert-input").value.trim(),t=document.getElementById("convert-format").value,n=document.getElementById("convert-result");if(e)try{const o=parseRelaxedJSON(e);let s="";switch(t){case"xml":s=jsonToXML(o);break;case"yaml":s=jsonToYAML(o);break;case"csv":s=jsonToCSV(o);break;case"typescript":s=jsonToTypeScript(o);break;case"go":s=jsonToGo(o);break;case"java":s=jsonToJava(o)}n.textContent=s}catch(e){n.textContent=`Error: ${e.message}`}else n.textContent="Please enter JSON to convert"}function jsonToXML(e,t=0){const n="  ".repeat(t);let o="";for(const[s,a]of Object.entries(e))Array.isArray(a)?a.forEach(e=>{o+=`${n}<${s}>\n`,o+="object"==typeof e?jsonToXML(e,t+1):`${n}  ${e}\n`,o+=`${n}</${s}>\n`}):"object"==typeof a&&null!==a?(o+=`${n}<${s}>\n`,o+=jsonToXML(a,t+1),o+=`${n}</${s}>\n`):o+=`${n}<${s}>${a}</${s}>\n`;return o}function jsonToYAML(e,t=0){const n="  ".repeat(t);let o="";for(const[s,a]of Object.entries(e))if(Array.isArray(a))o+=`${n}${s}:\n`,a.forEach(e=>{"object"==typeof e?(o+=`${n}  -\n`,o+=jsonToYAML(e,t+2)):o+=`${n}  - ${e}\n`});else if("object"==typeof a&&null!==a)o+=`${n}${s}:\n`,o+=jsonToYAML(a,t+1);else{o+=`${n}${s}: ${"string"==typeof a?`"${a}"`:a}\n`}return o}function jsonToCSV(e){if(Array.isArray(e)){if(0===e.length)return"";if("object"!=typeof e[0])return"value\n"+e.join("\n");const t=Object.keys(e[0]);let n=t.join(",")+"\n";return e.forEach(e=>{const o=t.map(t=>{const n=e[t];return"string"==typeof n&&n.includes(",")?`"${n}"`:n});n+=o.join(",")+"\n"}),n}return"key,value\n"+Object.entries(e).map(([e,t])=>`${e},${t}`).join("\n")}function jsonToTypeScript(e,t="Root"){let n=`interface ${t} {\n`;for(const[t,o]of Object.entries(e))n+=`  ${t}: ${getTypeScriptType(o)};\n`;return n+="}\n",n}function getTypeScriptType(e){return null===e?"null":Array.isArray(e)?0===e.length?"any[]":getTypeScriptType(e[0])+"[]":"object"==typeof e?"object":typeof e}function jsonToGo(e,t="Root"){let n=`type ${t} struct {\n`;for(const[t,o]of Object.entries(e)){n+=`    ${t.charAt(0).toUpperCase()+t.slice(1)} ${getGoType(o)} \`json:"${t}"\`\n`}return n+="}\n",n}function getGoType(e){return null===e?"interface{}":Array.isArray(e)?0===e.length?"[]interface{}":"[]"+getGoType(e[0]):"object"==typeof e?"map[string]interface{}":"number"==typeof e?Number.isInteger(e)?"int":"float64":"boolean"==typeof e?"bool":"string"}function jsonToJava(e,t="Root"){let n=`public class ${t} {\n`;for(const[t,o]of Object.entries(e))n+=`    private ${getJavaType(o)} ${t};\n`;return n+="}\n",n}function getJavaType(e){return null===e?"Object":Array.isArray(e)?0===e.length?"List<Object>":"List<"+getJavaType(e[0])+">":"object"==typeof e?"Map<String, Object>":"number"==typeof e?Number.isInteger(e)?"Integer":"Double":"boolean"==typeof e?"Boolean":"String"}function copyConverted(){const e=document.getElementById("convert-result").textContent;e&&!e.includes("Select a format")&&navigator.clipboard.writeText(e).then(()=>alert("Copied!"))}function csvToJSONTool(){const e=document.getElementById("csv-input").value.trim(),t=document.getElementById("csv-result");if(!e)return t.textContent="Enter CSV data",void t.classList.add("show");try{const n=e.split("\n");if(n.length<2)throw new Error("CSV must have header and data row");const o=n[0].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),s=[];for(let e=1;e<n.length;e++){if(!n[e].trim())continue;const t=n[e].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),a={};o.forEach((e,n)=>{let o=t[n];o&&!isNaN(o)&&(o=Number(o)),"true"===o&&(o=!0),"false"===o&&(o=!1),a[e]=o}),s.push(a)}t.textContent=JSON.stringify(s,null,2),t.classList.add("show")}catch(e){t.textContent=`Error: ${e.message}`,t.classList.add("show")}}function jsObjToJSON(){const e=document.getElementById("js-obj-input").value.trim(),t=document.getElementById("js-obj-result");if(e)try{const n=new Function("return "+e)();t.textContent=JSON.stringify(n,null,2),t.classList.add("show")}catch(e){t.textContent=`Error: ${e.message}`,t.classList.add("show")}}function sqlToJSONTool(){const e=document.getElementById("sql-input").value.trim(),t=document.getElementById("sql-result");if(e)try{const n=/INSERT\s+INTO\s+[\w`"'.]+\s*\(([^)]+)\)\s+VALUES\s*\(([^)]+)\);?/gim,o=[...e.matchAll(n)];if(0===o.length)throw new Error("No valid INSERT statements");const s=o.map(e=>{const t=e[1].split(",").map(e=>e.trim().replace(/[`"']/g,"")),n=e[2].split(",").map(e=>{let t=e.trim();return t.startsWith("'")||t.startsWith('"')?t=t.substring(1,t.length-1):isNaN(t)?"null"===t.toLowerCase()?t=null:"true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1):t=Number(t),t}),o={};return t.forEach((e,t)=>o[e]=n[t]),o});t.textContent=JSON.stringify(s,null,2),t.classList.add("show")}catch(e){t.textContent=`Error: ${e.message}`,t.classList.add("show")}}function findPath(){const e=document.getElementById("path-json").value,t=document.getElementById("search-value").value,n=document.getElementById("path-result");if(e&&t)try{const o=parseRelaxedJSON(e),s=[];!function e(n,o){for(const[a,i]of Object.entries(n)){const n=o?`${o}.${a}`:a;String(i)===t&&s.push(n),"object"==typeof i&&i&&e(i,n)}}(o,""),n.textContent=s.length?s.join("\n"):"Not found",n.classList.add("show"),n.style.display="block"}catch(e){n.textContent=e.message,n.classList.add("show")}}function compareJSON(){const e=document.getElementById("diff-json1").value,t=document.getElementById("diff-json2").value,n=document.getElementById("diff-result");if(e&&t)try{const o=parseRelaxedJSON(e),s=parseRelaxedJSON(t);JSON.stringify(o)===JSON.stringify(s)?n.textContent="Identical":n.textContent="Objects differ (Detailed diff skipped for brevity)",n.classList.add("show"),n.style.display="block"}catch(e){n.textContent=e.message,n.classList.add("show")}}function analyzeJSON(){const e=document.getElementById("stats-json").value,t=document.getElementById("stats-result");if(e)try{const n=parseRelaxedJSON(e),o={k:0,v:0,d:0};!function e(t,n){o.d=Math.max(o.d,n),"object"==typeof t&&t&&Object.entries(t).forEach(([t,s])=>{o.k++,o.v++,e(s,n+1)})}(n,1),t.textContent=`Keys: ${o.k}, Values: ${o.v}, Depth: ${o.d}`,t.classList.add("show"),t.style.display="block"}catch(e){t.textContent=e.message}}function escapeJSON(){document.getElementById("escape-result").textContent=JSON.stringify(document.getElementById("escape-input").value),document.getElementById("escape-result").style.display="block"}function unescapeJSON(){try{document.getElementById("escape-result").textContent=JSON.parse(document.getElementById("escape-input").value)}catch(e){document.getElementById("escape-result").textContent=e.message}document.getElementById("escape-result").style.display="block"}window.toggleOutputView=toggleOutputView,window.togglePanel=togglePanel,window.switchTab=switchTab,window.formatJSON=formatJSON,window.minifyJSON=minifyJSON,window.validateJSON=validateJSON,window.copyJSON=copyJSON,window.clearJSON=clearJSON,window.loadSample=loadSample,window.updateIndent=updateIndent,window.copyPath=copyPath,window.convertJSON=convertJSON,window.copyConverted=copyConverted,window.csvToJSONTool=csvToJSONTool,window.jsObjToJSON=jsObjToJSON,window.sqlToJSONTool=sqlToJSONTool,window.findPath=findPath,window.compareJSON=compareJSON,window.analyzeJSON=analyzeJSON,window.escapeJSON=escapeJSON,window.unescapeJSON=unescapeJSON,window.expandAll=()=>document.querySelectorAll(".tree-children").forEach(e=>e.classList.remove("collapsed")),window.collapseAll=()=>document.querySelectorAll(".tree-children").forEach(e=>e.classList.add("collapsed"));