document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".tools-grid"),t=document.querySelectorAll("[data-view]"),o=document.getElementById("sort-select");if(0===e.length)return;const r=localStorage.getItem("ztools_view_mode")||"grid",a=localStorage.getItem("ztools_sort_mode")||"default";function n(o){e.forEach(e=>{"list"===o?e.classList.add("list-view"):e.classList.remove("list-view")}),t.forEach(e=>{e.dataset.view===o?(e.classList.add("active"),e.style.backgroundColor="var(--primary-color)",e.style.color="white"):(e.classList.remove("active"),e.style.backgroundColor="transparent",e.style.color="var(--text-color)")})}function l(t){const o=JSON.parse(localStorage.getItem("ztools_recent")||"{}"),r=JSON.parse(localStorage.getItem("ztools_usage")||"{}");e.forEach(e=>{const a=Array.from(e.children);e.dataset.indexed||(a.forEach((e,t)=>e.dataset.originalIndex=t),e.dataset.indexed="true"),a.sort((e,a)=>{const n=e=>{const t=e.getAttribute("href");if(!t)return"";const o=t.split("/").filter(Boolean);return o[o.length-1]},l=n(e),s=n(a);if("az"===t){const t=e.querySelector("h3")?.innerText.trim()||"",o=a.querySelector("h3")?.innerText.trim()||"";return t.localeCompare(o)}if("za"===t){const t=e.querySelector("h3")?.innerText.trim()||"";return(a.querySelector("h3")?.innerText.trim()||"").localeCompare(t)}if("recent"===t){const e=o[l]||0;return(o[s]||0)-e}if("popular"===t){const e=r[l]||0;return(r[s]||0)-e}return parseInt(e.dataset.originalIndex)-parseInt(a.dataset.originalIndex)}),a.forEach(t=>e.appendChild(t))})}n(r),o&&(o.value=a,l(a)),t.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.view;n(t),localStorage.setItem("ztools_view_mode",t)})}),o&&o.addEventListener("change",e=>{const t=e.target.value;l(t),localStorage.setItem("ztools_sort_mode",t)})});