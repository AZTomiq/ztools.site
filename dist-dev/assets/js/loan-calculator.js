function formatCurrency(t){return new Intl.NumberFormat("vi-VN").format(Math.round(t))}function parseCurrency(t){return t&&parseInt(t.replace(/[^\d]/g,""),10)||0}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("loan-amount"),e=document.getElementById("loan-term"),n=document.getElementById("interest-rate"),r=document.getElementsByName("calculation-method"),a=document.getElementById("start-date"),o=document.getElementById("result-section"),c=document.getElementById("result-monthly"),l=document.getElementById("result-total-interest"),d=document.getElementById("result-total-payment"),i=document.getElementById("schedule-body"),u=document.getElementById("btn-calculate"),m=document.getElementById("btn-reset");t.addEventListener("input",function(t){const e=t.target.value.replace(/[^\d]/g,"");t.target.value=e?new Intl.NumberFormat("vi-VN").format(e):""}),a&&(a.valueAsDate=new Date),u.addEventListener("click",function(){const u=parseCurrency(t.value),m=parseInt(e.value,10),s=parseFloat(n.value);let y="reducing";for(const t of r)if(t.checked){y=t.value;break}if(!u||!m||!s)return void alert("Vui lòng nhập đầy đủ thông tin: Số tiền, thời hạn và lãi suất.");const g=s/100/12;let h=[],f=0,p=0,v=0,E=u;const I=a?new Date(a.value):new Date;if("reducing"===y){const t=u/m;for(let e=1;e<=m;e++){const n=E*g,r=e===m?E:t,a=r+n;f+=n,p+=a,1===e&&(v=a);const o=new Date(I);o.setMonth(I.getMonth()+e),h.push({month:e,date:o.toLocaleDateString("vi-VN"),principal:r,interest:n,payment:a,remaining:E-r}),E-=r}}else{const t=u/m,e=u*g;v=t+e;for(let n=1;n<=m;n++){const r=n===m?E:t,a=r+e;f+=e,p+=a;const o=new Date(I);o.setMonth(I.getMonth()+n),h.push({month:n,date:o.toLocaleDateString("vi-VN"),principal:r,interest:e,payment:a,remaining:E-r}),E-=r}}c.textContent=formatCurrency(v),l.textContent=formatCurrency(f),d.textContent=formatCurrency(p),function(t){let e="";t.forEach(t=>{e+=`\n                <tr>\n                    <td class="month-col">${t.month}</td>\n                    <td>${t.date}</td>\n                    <td>${formatCurrency(t.remaining>0?t.remaining+t.principal:t.principal)}</td> \x3c!-- Dư nợ đầu kỳ --\x3e\n                    <td>${formatCurrency(t.principal)}</td>\n                    <td>${formatCurrency(t.interest)}</td>\n                    <td style="font-weight:bold">${formatCurrency(t.payment)}</td>\n                    <td>${formatCurrency(Math.abs(t.remaining))}</td> \x3c!-- Dư nợ cuối kỳ --\x3e\n                </tr>\n            `}),i.innerHTML=e}(h),o.classList.add("show"),o.scrollIntoView({behavior:"smooth",block:"start"})}),m.addEventListener("click",function(){t.value="",e.value="",n.value="",o.classList.remove("show"),i.innerHTML="",r[0].checked=!0})});